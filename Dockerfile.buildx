FROM golang:1.18 AS build

COPY . /src
WORKDIR /src
RUN go get -v ./...
RUN go vet -v ./...
RUN CGO_ENABLED=0 GO111MODULE=on go build

FROM scratch
LABEL MAINTAINER="Martin Helmich <m.helmich@mittwald.de>"
COPY --from=build /src/kubernetes-replicator /kubernetes-replicator
CMD ["/kubernetes-replicator"]
